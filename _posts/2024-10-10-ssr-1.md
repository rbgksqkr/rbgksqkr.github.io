---
title: "[ìš°ì•„í•œí…Œí¬ì½”ìŠ¤] SSR ì§ì ‘ êµ¬í˜„í•˜ë©´ì„œ ì´í•´í•˜ê¸°"
layout: single
excerpt: SSRì„ ì§ì ‘ êµ¬í˜„í•´ë³´ë©°, ì–´ë–»ê²Œ SSRì´ ë™ì‘í•˜ê³  hydrationì´ ì´ë¤„ì§€ëŠ”ì§€ ì´í•´í•œë‹¤.

categories:
  - woowacourse
tags: [ìš°ì•„í•œí…Œí¬ì½”ìŠ¤, SSR, hydration]
toc_label: SSR(1)
toc: true
toc_sticky: true
---

# âœ… ì½”ë“œ íë¦„ìœ¼ë¡œ SSR ì´í•´

ì½”ë“œë¥¼ í•œì¤„ì”© ë”°ë¼ê°€ë©° SSRì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì´í•´í•˜ì.

<div class="red-box">
    <div>1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000 ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ index.html ìš”ì²­í•œë‹¤.</div>
    <div>2. SSRì„œë²„ëŠ” router.get(â€/â€) ìœ¼ë¡œ ìš”ì²­ì„ ë°›ì€ í›„ <mark class="mark">API ì„œë²„ë¡œ ë°ì´í„° ìš”ì²­</mark>í•œë‹¤.</div>
    <div>3. ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ë¥¼ ì´ìš©í•˜ì—¬ ì‘ë‹µë°›ì€ ë°ì´í„°ë¥¼ <mark class="mark">window ì „ì—­ ê°ì²´ì— ì´ˆê¸°í™”</mark>í•œë‹¤.</div>
    <div>4. <span class="high">renderToString</span> í•¨ìˆ˜ë¥¼ í†µí•´ <mark class="mark">React íŠ¸ë¦¬ë¥¼ HTML ë¬¸ìì—´ë¡œ ë³€í™˜</mark>í•œë‹¤.</div>
    <div>5. SSRì„œë²„ì— ì¡´ì¬í•˜ëŠ” index.html íŒŒì¼ì„ ì°¾ì•„ stringìœ¼ë¡œ ì½ì–´ì˜¨ë‹¤.</div>
    <div>6. ì•ì—ì„œ ê°€ì ¸ì˜¨ App ì»´í¬ë„ŒíŠ¸ì™€ API ì‘ë‹µ ë°ì´í„°ë¥¼ ì£¼ì…í•˜ëŠ” initDataë¥¼ index.html íŒŒì¼ì— ì£¼ì…í•œë‹¤.</div>
    <div>7. ë³€í™˜ëœ HTML íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì— ì‘ë‹µí•œë‹¤. (res.send)</div>
    <div>8. ë¸Œë¼ìš°ì €ëŠ” ì‘ë‹µë°›ì•„ HTMLì„ íŒŒì‹±í•˜ë©° bundle.jsë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ë¥¼ ë§Œë‚˜ë©´ client/index.js ë¥¼ ë‹¤ìš´ë°›ì•„ ì‹¤í–‰í•œë‹¤.</div>
    <div>9. <mark class="mark">index.js ì—ì„œ ë§Œë“œëŠ” React DOMê³¼ SSR ì„œë²„ì—ì„œ ë§Œë“  HTMLì„ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´</mark> window ì „ì—­ ê°ì²´ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì£¼ì…í•œë‹¤.</div>
    <div>10. ì„œë²„ì—ì„œ ë§Œë“  ì •ì  HTMLì— ì»´í¬ë„ŒíŠ¸ ë¡œì§ì„ ê²°í•©ì‹œì¼œ ìƒí˜¸ì‘ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ hydration í•œë‹¤.</div>
</div>

<div>1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000 ìœ¼ë¡œ ì ‘ê·¼í•˜ì—¬ index.html ìš”ì²­í•œë‹¤.</div>

<img width="600" alt="index.html ì²« ë¡œë“œ" src="https://github.com/user-attachments/assets/67610aca-31ac-48a5-9ce6-c5aed2cc0c83">

<div>2. SSRì„œë²„ëŠ” router.get(â€/â€) ìœ¼ë¡œ ìš”ì²­ì„ ë°›ì€ í›„ API ì„œë²„ë¡œ ë°ì´í„° ìš”ì²­í•œë‹¤.</div>

```js
router.get("/", async (_, res) => {
  const movies = await fetchMovies();
  const movieItems = parseMovieItems(movies);
  const bestMovieItem = movieItems[0];
  ...
}
```

<div>3. ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ë¥¼ ì´ìš©í•˜ì—¬ ì‘ë‹µë°›ì€ ë°ì´í„°ë¥¼ window ì „ì—­ ê°ì²´ì— ì´ˆê¸°í™”í•œë‹¤.</div>

```js
router.get("/", async (_, res) => {
	...
  const initData = /*html*/ `
    <script>
      window.__INITIAL_DATA__ = {
        movies: ${JSON.stringify(movieItems)}
      }
    </script>
  `;
	...
});
```

<div>4. `renderToString` í•¨ìˆ˜ë¥¼ í†µí•´ React íŠ¸ë¦¬ë¥¼ HTML ë¬¸ìì—´ë¡œ ë³€í™˜í•œë‹¤.</div>

```js
router.get("/", async (_, res) => {
	...
  const renderedApp = renderToString(
    <App popularMovies={movieItems} bestMovieItem={bestMovieItem} />
  );
  ...
});
```

<div>5. SSRì„œë²„ì— ì¡´ì¬í•˜ëŠ” index.html íŒŒì¼ì„ ì°¾ì•„ stringìœ¼ë¡œ ì½ì–´ì˜¨ë‹¤.</div>

```jsx
const router = Router();

router.get("/", async (_, res) => {
	...
  const templatePath = path.resolve(__dirname, "index.html");
  const template = fs.readFileSync(templatePath, "utf-8");
  ...
});
```

<div style="display:flex; flex-direction: column; gap: 16px;">
  <div>6. ì•ì—ì„œ ê°€ì ¸ì˜¨ App ì»´í¬ë„ŒíŠ¸ì™€ API ì‘ë‹µ ë°ì´í„°ë¥¼ ì£¼ì…í•˜ëŠ” initDataë¥¼ index.html íŒŒì¼ì— ì£¼ì…í•œë‹¤.</div>
  <div>7. ë³€í™˜ëœ HTML íŒŒì¼ì„ ë¸Œë¼ìš°ì €ì— ì‘ë‹µí•œë‹¤. (res.send)</div>
</div>

```jsx
router.get("/", async (_, res) => {
  ...
  res.send(
    template
      .replace('<div id="root"></div>', `<div id="root">${renderedApp}</div>`)
      .replace("<!--${INIT_DATA_AREA}-->", initData)
  );
});
```

<div style="display:flex; flex-direction: column; gap: 16px;">
  <div>8. ë¸Œë¼ìš°ì €ëŠ” ì‘ë‹µë°›ì•„ HTMLì„ íŒŒì‹±í•˜ë©° bundle.jsë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ìŠ¤í¬ë¦½íŠ¸ íƒœê·¸ë¥¼ ë§Œë‚˜ë©´ client/index.js ë¥¼ ë‹¤ìš´ë°›ì•„ ì‹¤í–‰í•œë‹¤.</div>
  <div>9. index.js ì—ì„œ ë§Œë“œëŠ” React DOMê³¼ SSR ì„œë²„ì—ì„œ ë§Œë“  HTMLì„ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´ window ì „ì—­ ê°ì²´ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ì£¼ì…í•œë‹¤.</div>
  <div>10. ì„œë²„ì—ì„œ ë§Œë“  ì •ì  HTMLì— ì»´í¬ë„ŒíŠ¸ ë¡œì§ì„ ê²°í•©ì‹œì¼œ ìƒí˜¸ì‘ìš©ì´ ê°€ëŠ¥í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ hydration í•œë‹¤.</div>
</div>

```jsx
import React from "react";
import { hydrateRoot } from "react-dom/client";
import App from "./App";

const data = window.__INITIAL_DATA__;

hydrateRoot(
  document.getElementById("root"),
  <App popularMovies={data.movies} bestMovieItem={data.movies[0]} />
);
```

## âœ… ê²°ê³¼ ì½”ë“œ

<div style="font-weight: bold;">ğŸš¨ index.js</div>

```js
router.get("/", async (_, res) => {
  const movies = await fetchMovies();
  const movieItems = parseMovieItems(movies);
  const bestMovieItem = movieItems[0];

const initData = /_html_/ `

  <script>
    window.__INITIAL_DATA__ = {
      movies: ${JSON.stringify(movieItems)}
    }
  </script>

`;

const renderedApp = renderToString(
<App popularMovies={movieItems} bestMovieItem={bestMovieItem} />
);

const templatePath = path.resolve(\_\_dirname, "index.html");
const template = fs.readFileSync(templatePath, "utf-8");

res.send(
template
.replace('<div id="root"></div>', `<div id="root">${renderedApp}</div>`)
.replace("<!--${INIT_DATA_AREA}-->", initData)
);
});

```

<div style="font-weight: bold;">ğŸš¨ index.html</div>

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./static/styles/index.css" />
    <title>ì˜í™” ë¦¬ë·°</title>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <!--${INIT_DATA_AREA}-->
</html>
```

<div style="font-weight: bold;">ğŸš¨ client/index.js</div>

```jsx
import React from "react";
import { hydrateRoot } from "react-dom/client";
import App from "./App";

const data = window.__INITIAL_DATA__;

hydrateRoot(
  document.getElementById("root"),
  <App popularMovies={data.movies} bestMovieItem={data.movies[0]} />
);
```

webpackìœ¼ë¡œ ë²ˆë“¤ë§í•˜ë©´ì„œ script íƒœê·¸ê°€ ì¶”ê°€ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

<img width="600" alt="bundle ë¶ˆëŸ¬ì˜¤ëŠ” ìŠ¤í¬ë¦½íŠ¸" src="https://github.com/user-attachments/assets/3177c0a3-b5de-4501-9d47-e634438bf4e6">

## ğŸ“˜ reference

[React - renderToString](https://ko.react.dev/reference/react-dom/server/renderToString)
